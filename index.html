<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Drone Pre-Flight Environmental Analysis System</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
:root {
  --brand-blue: #0077b6;
  --brand-green: #2a9d8f;
  --brand-red: #e63946;
  --brand-yellow: #ffe066;
  --brand-white: #ffffff;
  --brand-bg: #f8f9fa;
  --brand-dark: #2c3e50;
  --brand-light: #e9ecef;
  --card-radius: 18px;
  --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
  --main-font: 'Poppins', Arial, sans-serif;
}
body { margin:0; padding:0; font-family:var(--main-font); background:var(--brand-bg); color:var(--brand-dark);}
#app { display: flex; flex-direction: column; min-height: 100vh;}
header {
  width: 100%; background: linear-gradient(90deg, var(--brand-blue) 0%, #48cae4 100%);
  padding: 24px 20px; box-shadow: var(--shadow-lg);
  display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 10;
}
.header-left { display: flex; align-items: center; gap: 20px; }
.logo-title { font-family: var(--logo-font); font-size: 2.8rem; font-weight: 900; letter-spacing: 2px; color: #ffb703; text-shadow: 1px 2px 8px rgba(0, 0, 0, 0.1), 0 1px 0 #fff; margin: 0; }
.subtitle { font-size: 1.1rem; font-weight: 500; color: #caf0f8; letter-spacing: 0.5px;}
.header-right { display: flex; align-items: center; gap: 15px; margin-right: 20px;}
.userbar { background: var(--brand-white); border-radius: 40px; box-shadow: var(--shadow-lg); padding: 8px 16px 8px 10px; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; font-weight: 500; color: var(--brand-blue);}
.user-avatar { height: 34px; width: 34px; border-radius: 50%; background: linear-gradient(135deg, var(--brand-green) 40%, var(--brand-blue) 90%); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 1.1rem; font-weight: bold;}
.user-role { font-size: 0.85rem; font-weight: 400; color: #6c757d; display: none;}
main { flex-grow:1; width:100%; max-width:960px; margin:0 auto; padding:32px 10px; display:flex; justify-content:center; position:relative; min-height:520px;}
section { width:100%; max-width:760px; background: var(--brand-white); border-radius: var(--card-radius); box-shadow: var(--shadow-lg); padding:40px 28px 38px; display:none; flex-direction:column; align-items:center; position:absolute; left:50%; top:50px; transform: translateX(-50%) translateY(0); opacity:0; z-index:1; min-height:520px; transition: opacity 0.4s, transform 0.4s; }
section.active { display:flex; opacity:1; transform: translateX(-50%) translateY(0);}
.login-card, .welcome-card { box-shadow:0 8px 32px rgba(0,0,0,0.1); padding:32px 40px; background: var(--brand-light); border-radius:24px; width:100%; max-width:360px; margin:0 auto; display:flex; flex-direction:column; align-items:center; gap:20px;}
.login-card h2 { text-align: center; font-size: 1.35rem; font-weight: 600; color: var(--brand-blue); margin-bottom: 0;}
.login-card label { margin-bottom: 5px; color: var(--brand-blue); font-weight: 500; font-size: 0.95rem; margin-left: 10px; align-self: flex-start;}
.login-card input { width:100%; padding:14px 16px; border:2px solid var(--brand-blue); border-radius:12px; font-size:1rem; margin-bottom:8px; font-family:var(--main-font); outline:none; transition: border-color 0.2s, box-shadow 0.2s;}
.login-card input:focus { border-color: var(--brand-green); box-shadow: 0 0 10px rgba(42, 157, 143, 0.2); }
.login-card .btn { width:100%; margin-top:12px;}
.login-error { color:var(--brand-red); margin-bottom:6px; font-size:0.95rem; font-weight:500;}
.welcome-card {padding:40px 40px 34px; background: linear-gradient(135deg, var(--brand-white) 0%, var(--brand-light) 100%); box-shadow: var(--shadow-lg);}
.welcome-avatar { height:72px; width:72px; border-radius:50%; background:linear-gradient(135deg, var(--brand-green) 46%, var(--brand-blue) 84%); color: #fff; font-size:2.2rem; font-weight:bold; line-height:72px; text-align:center; margin-bottom:18px; box-shadow:0 2px 20px rgba(0,0,0,0.1);}
.welcome-greeting { font-size:1.8rem; font-weight:700; margin-bottom:8px; color: var(--brand-blue); letter-spacing:0.2px; text-align:center;}
.welcome-message { font-size:1.1rem; color:var(--brand-dark); margin-bottom:22px; text-align:center; font-weight:400;}
.btn {
  background: linear-gradient(90deg,var(--brand-blue) 0%, var(--brand-green) 100%);
  color: white; font-size: 1.1rem; font-weight: 600; padding: 15px 42px; border: none; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 119, 182, 0.2); user-select: none; margin-top: 8px;
}
.btn:active { transform: translateY(1px); }
.controls { display:flex; flex-wrap:wrap; justify-content:center; align-items:flex-end; gap: 16px; margin-bottom: 24px;}
input[type=text].input-box { font-size: 1rem; padding: 14px 16px; border-radius: 12px; border: 2px solid var(--brand-blue); width: 320px; max-width: 100%; outline: none;}
input[type=text].input-box:focus { border-color: var(--brand-green); box-shadow:0 0 10px rgba(42, 157, 143, 0.2);}
#map { width:100%; min-height: 220px; height:300px; border-radius:var(--card-radius); box-shadow: var(--shadow-lg); margin-bottom:16px;}
@media (max-width:600px) {.logo-title{font-size:1.4rem;} .subtitle{font-size:0.92rem;}}
/* Gauges section */
.hardware-gauges {display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:20px;width:100%;margin:18px auto;}
.gauge-card {background:var(--brand-light);border-radius:16px;box-shadow:var(--shadow-lg);padding:16px 8px 18px;display:flex;flex-direction:column;align-items:center;}
.gauge-title {font-weight:700;font-size:1.13rem;margin-bottom:10px;color:var(--brand-dark);}
.gauge-value {font-size:1.5rem;margin-top:10px;font-weight:700;}
footer { padding: 18px 20px; text-align: center; font-size: 0.9rem; background: var(--brand-dark); color: var(--brand-white);}
</style>
</head>
<body>
 <div id="app">
   <header>
     <div class="header-left">
       <span class="logo-title">ARKIN LABS</span>
       <span class="subtitle">Drone Pre-Flight Environmental Analysis System</span>
     </div>
      <div class="header-right" id="userHeader" style="display:none;">
        <div class="userbar" id="userbar">
          <div class="user-avatar" id="userAvatar"></div>
          <span id="userNameDisp"></span>
          <span class="user-role" id="userRoleDisp"></span>
        </div>
      </div>
   </header>
   <main>
     <section id="page-login" class="active">
       <form id="loginForm" class="login-card" autocomplete="off">
         <h2>User Login</h2>
         <div class="login-error" id="loginError"></div>
         <label for="username">Username</label>
         <input id="username" name="username" type="text" required maxlength="32" placeholder="e.g. lokesh" autofocus />
         <label for="password">Password</label>
         <input id="password" name="password" type="password" required maxlength="32" placeholder="Password" />
         <button type="submit" class="btn">Login</button>
       </form>
     </section>
     <section id="page-welcome">
       <div class="welcome-card">
         <div class="welcome-avatar" id="welcomeAvatar"></div>
         <div class="welcome-main">
           <div class="welcome-greeting">Welcome, <span id="userWelcome"></span>!</div>
           <div class="welcome-message">
             Ready to analyze your environment for a safe drone flight? <br>
             Follow the steps below to begin.
           </div>
           <button id="btnStart" class="btn" aria-label="Start the app">
             <span style="margin-right:6px;">ðŸ›«</span>Continue
           </button>
         </div>
       </div>
     </section>
     <section id="page-data">
       <div class="controls">
         <input type="text" id="locationInput" class="input-box" placeholder="Enter a location (city, landmark, etc.)" autocomplete="off" />
         <button id="btnCheckLocation" class="btn" aria-label="Check the location">Check Location</button>
       </div>
       <div id="map"></div>
       <div id="dataMessage" style="margin-top: 12px; font-weight: 500; font-size: 1rem; color: var(--brand-blue); min-height: 28px;" aria-live="polite" aria-atomic="true"></div>
       <div class="controls" id="hardwareFetchContainer">
         <button id="btnFetchHardware" class="btn" aria-label="Get data from hardware">Get Data from Hardware</button>
       </div>
     </section>
     <section id="page-results">
       <div class="status-card good" id="resultStatus">
         <span class="status-dot"></span>
         <span id="resultStatusText">Good to Fly</span>
       </div>
       <div class="hardware-gauges" id="hardwareGauges"></div>
       <button id="btnRestart" class="btn-secondary" aria-label="Restart analysis">Back to Start</button>
     </section>
   </main>
   <footer>&copy; 2025 ARKIN LABS. All rights reserved.</footer>
 </div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const pages = {
  login: document.getElementById('page-login'),
  welcome: document.getElementById('page-welcome'),
  data: document.getElementById('page-data'),
  results: document.getElementById('page-results')
};
const userHeader = document.getElementById('userHeader');
const userbar = document.getElementById('userbar');
const userAvatar = document.getElementById('userAvatar');
const userNameDisp = document.getElementById('userNameDisp');
const userRoleDisp = document.getElementById('userRoleDisp');
const userWelcome = document.getElementById('userWelcome');
const welcomeAvatar = document.getElementById('welcomeAvatar');
const btnStart = document.getElementById('btnStart');
const btnCheckLocation = document.getElementById('btnCheckLocation');
const btnFetchHardware = document.getElementById('btnFetchHardware');
const btnRestart = document.getElementById('btnRestart');
const locationInput = document.getElementById('locationInput');
const dataMessage = document.getElementById('dataMessage');
const resultStatus = document.getElementById('resultStatus');
const resultStatusText = document.getElementById('resultStatusText');
const hardwareGauges = document.getElementById('hardwareGauges');
const loginForm = document.getElementById('loginForm');
const loginError = document.getElementById('loginError');
let userData = null;

// OSM & Marker Setup
let map, osmMarker;
function setupMap() {
  map = L.map('map').setView([28.6139, 77.209], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);
}

function searchAndShowLocation(qstr) {
  if(!qstr.trim()) return;
  fetch('https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(qstr))
    .then(r=>r.json())
    .then(arr=>{
      if(arr.length) {
        const lat = +arr[0].lat, lon = +arr[0].lon;
        map.setView([lat,lon], 15, {animate:true});
        if(osmMarker) map.removeLayer(osmMarker);
        osmMarker = L.marker([lat, lon]).addTo(map).bindPopup(arr[0].display_name).openPopup();
        dataMessage.style.color = "var(--brand-blue)";
        dataMessage.textContent = "Found: " + arr[0].display_name;
      } else {
        dataMessage.style.color = "var(--brand-red)";
        dataMessage.textContent = "Location not found.";
      }
    });
}
// Gauges (SVG, animated)
function gaugeSVG({label,value,min,max,unit}) {
  value = Math.max(min, Math.min(max, value));
  const percent = (value-min)/(max-min);
  const angle = -90 + 180*percent;
  const bands = [
    {start:-90,end:-30,color:'#e63946'},
    {start:-30,end:30,color:'#ffe066'},
    {start:30,end:90,color:'#2a9d8f'}
  ];
  function arc(start,end,color){
    const r=62, xc=75, yc=84;
    const rad = d => Math.PI/180*d;
    const x1 = xc + r * Math.cos(rad(start));
    const y1 = yc + r * Math.sin(rad(start));
    const x2 = xc + r * Math.cos(rad(end));
    const y2 = yc + r * Math.sin(rad(end));
    const largeArc = end-start>180?1:0;
    return `<path d="M${x1},${y1} A${r},${r} 0 ${largeArc} 1 ${x2},${y2}" stroke="${color}" stroke-width="14" fill="none"/>`;
  }
  const r=62, xc=75, yc=84, needleLen=54, aRad = Math.PI/180*angle;
  const nx = xc + needleLen * Math.cos(aRad);
  const ny = yc + needleLen * Math.sin(aRad);
  return `
    <svg width="150" height="95" viewBox="0 0 150 100" style="margin-bottom:-8px;">
      ${bands.map(b=>arc(b.start,b.end,b.color)).join("")}
      <circle cx="${xc}" cy="${yc}" r="8" fill="#222"/>
      <line x1="${xc}" y1="${yc}" x2="${nx}" y2="${ny}" stroke="#222" stroke-width="5" stroke-linecap="round"/>
    </svg>
    <div class="gauge-value">${value} ${unit||''}</div>
  `;
}
function emiValue(val) {
  if(val==="Low")return 20;if(val==="Medium")return 55;if(val==="High")return 89;return 0;
}
function continuousSensorData() {
  return {
    temperature: Math.round(25 + Math.random()*8 + 5*Math.sin(Date.now()/8500)),
    humidity: Math.round(48 + Math.random()*44 + 17*Math.cos(Date.now()/10600)),
    wind: Math.round(8 + 18*Math.abs(Math.sin(Date.now()/4100))),
    emi: ["Low","Medium","High"][Math.floor(3*Math.abs(Math.sin(Date.now()/5700)))]
  };
}
function renderLiveGauges(hw) {
  hardwareGauges.innerHTML = `
    <div class="gauge-card"><div class="gauge-title">Temperature</div>${gaugeSVG({label:"Temperature",value:hw.temperature,min:10,max:45,unit:"Â°C"})}</div>
    <div class="gauge-card"><div class="gauge-title">Humidity</div>${gaugeSVG({label:"Humidity",value:hw.humidity,min:20,max:100,unit:"%"})}</div>
    <div class="gauge-card"><div class="gauge-title">Wind Speed</div>${gaugeSVG({label:"Wind",value:hw.wind,min:0,max:30,unit:"km/h"})}</div>
    <div class="gauge-card"><div class="gauge-title">EMI Level</div>${gaugeSVG({label:"EMI",value:emiValue(hw.emi),min:0,max:100,unit:""})}
      <div style="margin-top:3px;color:#444;font-size:1.03rem">${hw.emi}</div></div>
  `;
}
let gaugeInterval = null;
function startHardwareFeed() {
  if(gaugeInterval) clearInterval(gaugeInterval);
  gaugeInterval = setInterval(()=>renderLiveGauges(continuousSensorData()), 1000);
}

// Login and navigation
function showPage(key) {
  Object.values(pages).forEach(p=>p.classList.remove('active'));
  pages[key].classList.add('active');
}
loginForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const username = loginForm.username.value.trim();
  const password = loginForm.password.value;
  if (!username || !password) {
    loginError.textContent = "Please enter both username and password.";
    return;
  }
  if ((username === "user1" || username === "user2" || username === "admin") && password === "drone") {
    userData = {
      username,
      role: username === "admin" ? "Administrator" : "Operator",
      avatar: username.slice(0,2).toUpperCase()
    };
    loginError.textContent = "";
    userHeader.style.display = "flex";
    userAvatar.textContent = userData.avatar;
    userNameDisp.textContent = userData.username[0].toUpperCase() + userData.username.slice(1);
    userRoleDisp.textContent = " ("+userData.role+")";
    userWelcome.textContent = userNameDisp.textContent;
    welcomeAvatar.textContent = userData.avatar;
    showPage("welcome");
  } else {
    loginError.textContent = "Invalid credentials. Try username 'user1', 'user2', or 'admin' and password 'drone'.";
  }
});
btnStart.addEventListener("click", ()=> { showPage("data"); setupMap(); });
btnCheckLocation.addEventListener("click", () => {
  const locationStr = locationInput.value.trim();
  dataMessage.textContent = "";
  if (!locationStr) {
    dataMessage.style.color = "var(--brand-red)";
    dataMessage.textContent = "Please enter a location.";
    return;
  }
  searchAndShowLocation(locationStr);
});
btnFetchHardware.addEventListener("click", () => {
  showPage("results");
  startHardwareFeed();
});
btnRestart.addEventListener("click", () => {
  locationInput.value = "";
  dataMessage.textContent = "";
  if(osmMarker) map.removeLayer(osmMarker);
  hardwareGauges.innerHTML = "";
  resultStatus.classList.remove("bad"); resultStatus.classList.add("good");
  resultStatusText.textContent = "Good to Fly";
  showPage("welcome");
});
locationInput.addEventListener("keydown", e => {
  if(e.key === "Enter"){
    e.preventDefault(); btnCheckLocation.click();
  }
});
</script>
</body>
</html>
